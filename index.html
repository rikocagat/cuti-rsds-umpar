<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pengajuan Cuti RSDS</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Supabase JS v2 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Signature Pad -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<style>
  body{
    background:linear-gradient(180deg,#e0f2fe,#f8fafc);
  }
  .card{
    background:#fff;
    border-radius:26px;
    box-shadow:0 25px 50px rgba(2,6,23,.12);
  }
  .input{
    width:100%;padding:14px;
    border-radius:16px;border:1px solid #cbd5e1;
  }
  .input:focus{
    outline:none;border-color:#38bdf8;
    box-shadow:0 0 0 4px rgba(56,189,248,.25)
  }
  .ac{
    position:absolute;z-index:50;background:#fff;
    border:1px solid #e2e8f0;border-radius:16px;
    max-height:260px;overflow:auto;
    box-shadow:0 14px 30px rgba(0,0,0,.15)
  }
  .ac-item{
    padding:12px 16px;
    display:flex;justify-content:space-between;
    cursor:pointer
  }
  .ac-item:hover{background:#e0f2fe}
</style>
</head>

<body class="min-h-screen flex justify-center p-4">
<main class="card w-full max-w-xl p-6">

<h1 class="text-2xl font-bold text-sky-700 mb-1">Pengajuan Cuti</h1>
<p class="text-sm text-slate-500 mb-6">RSUD dr. Soedarso</p>

<!-- FORM DATA -->
<section>
  <label class="font-semibold text-sm">Nama</label>
  <div class="relative mb-3">
    <input id="nama" class="input" placeholder="Ketik minimal 2 huruf" autocomplete="off">
    <div id="acBox" class="ac hidden"></div>
  </div>

  <label class="font-semibold text-sm">NIP</label>
  <input id="nip" class="input mb-3" readonly>

  <label class="font-semibold text-sm">No HP</label>
  <input id="hp" class="input mb-3">

  <label class="font-semibold text-sm">Jenis Cuti</label>
  <select id="jenis" class="input mb-3" onchange="updateReq()">
    <option value="">Pilih</option>
    <option>TAHUNAN</option>
    <option>SAKIT</option>
    <option>MELAHIRKAN</option>
    <option>BESAR</option>
    <option>ALASAN_PENTING</option>
    <option>LUAR_NEGARA</option>
  </select>

  <div class="grid grid-cols-2 gap-3">
    <input id="tgl" type="date" class="input">
    <input id="lama" type="number" class="input" placeholder="Lama (hari)">
  </div>

  <textarea id="alamat" class="input mt-3" placeholder="Alamat selama cuti"></textarea>

  <div id="reqBox" class="mt-4 p-4 rounded-xl bg-sky-50 border border-sky-200 text-sm"></div>

  <div class="mt-5">
    <label class="font-semibold text-sm">Upload 2 File PDF</label>
    <input id="pdf1" type="file" accept="application/pdf" class="mt-2">
    <input id="pdf2" type="file" accept="application/pdf" class="mt-2">
  </div>

  <button onclick="showTTD()" class="mt-6 w-full py-3 rounded-xl bg-sky-600 text-white font-semibold">
    Lanjut ke Tanda Tangan
  </button>
</section>

<!-- TTD -->
<section id="ttdSection" class="hidden mt-8">
  <h2 class="text-lg font-bold mb-2">Tanda Tangan</h2>
  <canvas id="pad" class="w-full h-40 bg-white border rounded-xl"></canvas>
  <button onclick="pad.clear()" class="text-sm text-red-500 mt-1">Hapus</button>

  <button onclick="submitForm()" class="mt-4 w-full py-3 rounded-xl bg-emerald-600 text-white font-semibold">
    Kirim Pengajuan
  </button>
</section>

<div id="done" class="hidden text-center py-10">
  <h2 class="text-xl font-bold text-emerald-600">Berhasil</h2>
  <p class="text-sm">Pengajuan cuti terkirim.</p>
</div>

</main>

<script>
/* ===== CONFIG ===== */
const SUPABASE_URL = 'https://ufiqibxdgwlysqhinqbz.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_EVSVWnsUriOPA_O3RnGTpg_Zmd4pyAL';
const sb = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const requirements = {
  TAHUNAN:['BERKAS CUTI TERAKHIR','FORMULIR PERMOHONAN CUTI'],
  SAKIT:['SURAT KETERANGAN DOKTER','FORMULIR PERMOHONAN CUTI'],
  MELAHIRKAN:['SURAT KETERANGAN DOKTER','FORMULIR PERMOHONAN CUTI'],
  BESAR:['FORMULIR PERMOHONAN CUTI TTD KABID/KABAG'],
  ALASAN_PENTING:['BUKTI ALASAN PENTING','FORMULIR PERMOHONAN CUTI'],
  LUAR_NEGARA:['SURAT PERMOHONAN TTD PPK','FORMULIR PERMOHONAN CUTI']
};

let pad;

/* ===== AUTOCOMPLETE ===== */
const nama=document.getElementById('nama');
const nip=document.getElementById('nip');
const box=document.getElementById('acBox');
let t;

nama.addEventListener('input',()=>{
  clearTimeout(t); nip.value='';
  const q=nama.value.trim();
  if(q.length<2){box.classList.add('hidden');return;}

  t=setTimeout(async()=>{
    const {data}=await sb.from('pegawai')
      .select('nama,nip_nik')
      .ilike('nama',q+'%')
      .limit(10);

    box.innerHTML='';
    if(!data?.length){
      box.innerHTML='<div class="p-4 text-slate-400">Tidak ada data</div>';
    }else{
      data.forEach(r=>{
        const d=document.createElement('div');
        d.className='ac-item';
        d.innerHTML=`<span>${r.nama}</span><span>${r.nip_nik}</span>`;
        d.onclick=()=>{nama.value=r.nama; nip.value=r.nip_nik; box.classList.add('hidden');};
        box.appendChild(d);
      });
    }
    box.classList.remove('hidden');
  },300);
});

/* ===== REQUIREMENTS ===== */
function updateReq(){
  const j=jenis.value;
  reqBox.innerHTML=requirements[j]?.map(r=>'â€¢ '+r).join('<br>')||'';
}

/* ===== TTD ===== */
function showTTD(){
  document.getElementById('ttdSection').classList.remove('hidden');
  pad=new SignaturePad(document.getElementById('pad'),{backgroundColor:'#fff'});
  window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
}

/* ===== SUBMIT (dummy insert ready) ===== */
function submitForm(){
  if(pad.isEmpty()) return alert('Tanda tangan wajib');
  done.classList.remove('hidden');
}
</script>
</body>
</html>
