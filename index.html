<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pengajuan Cuti RSDS</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Supabase JS v2 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body{background:#f1f5f9}
  .input{width:100%;padding:12px;border-radius:14px;border:1px solid #cbd5e1}
  .btn{width:100%;padding:12px;border-radius:14px;font-weight:600}
  .ac{
    position:absolute;z-index:50;background:#fff;
    border:1px solid #e2e8f0;border-radius:14px;
    max-height:240px;overflow:auto;
    box-shadow:0 10px 25px rgba(0,0,0,.1)
  }
  .ac-item{padding:10px 14px;cursor:pointer;display:flex;justify-content:space-between}
  .ac-item:hover{background:#f0f9ff}
</style>
</head>

<body class="min-h-screen flex justify-center p-4">
<main class="bg-white w-full max-w-md rounded-3xl shadow-xl p-5 relative">

<h1 class="text-xl font-bold mb-1">Pengajuan Cuti</h1>
<p class="text-sm text-slate-500 mb-4">RSUD dr. Soedarso</p>

<section>
  <div class="relative mb-3">
    <input id="nama" class="input" placeholder="Nama (ketik min 2 huruf)" autocomplete="off">
    <div id="acBox" class="ac hidden"></div>
  </div>

  <input id="nip" class="input mb-2" placeholder="NIP" readonly>
  <input id="hp" class="input mb-2" placeholder="No HP">

  <select id="jenis" class="input mb-2">
    <option value="">Jenis Cuti</option>
    <option>TAHUNAN</option>
    <option>SAKIT</option>
    <option>MELAHIRKAN</option>
    <option>BESAR</option>
    <option>ALASAN_PENTING</option>
    <option>LUAR_NEGARA</option>
  </select>

  <input id="tgl" type="date" class="input mb-2">
  <input id="lama" type="number" class="input mb-2" placeholder="Lama (hari)">
  <textarea id="alamat" class="input mb-4" placeholder="Alamat selama cuti"></textarea>

  <button class="btn bg-emerald-500 text-white" onclick="alert('Form OK')">
    Submit (dummy)
  </button>
</section>

</main>

<script>
/* ================= KONFIGURASI ================= */
const SUPABASE_URL = 'https://ufiqibxdgwlysqhinqbz.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_EVSVWnsUriOPA_O3RnGTpg_Zmd4pyAL';

/* ================= INIT SUPABASE (WAJIB) ================= */
const sb = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ================= AUTOCOMPLETE NAMA ================= */
function setupAutocomplete(){
  const nama = document.getElementById('nama');
  const nip  = document.getElementById('nip');
  const box  = document.getElementById('acBox');
  let timer;

  nama.addEventListener('input', () => {
    const q = nama.value.trim();
    nip.value = '';
    clearTimeout(timer);

    if (q.length < 2){
      box.classList.add('hidden');
      box.innerHTML = '';
      return;
    }

    timer = setTimeout(async () => {
      const { data, error } = await sb
        .from('pegawai')
        .select('nama, nip_nik')
        .ilike('nama', q + '%')
        .order('nama')
        .limit(10);

      if (error){
        console.error(error);
        box.innerHTML = `<div class="p-3 text-red-500">Error query</div>`;
        box.classList.remove('hidden');
        return;
      }

      if (!data || data.length === 0){
        box.innerHTML = `<div class="p-3 text-slate-400">Tidak ada data</div>`;
        box.classList.remove('hidden');
        return;
      }

      box.innerHTML = '';
      data.forEach(r => {
        const item = document.createElement('div');
        item.className = 'ac-item';
        item.innerHTML = `
          <span>${r.nama}</span>
          <span class="text-slate-500">${r.nip_nik}</span>
        `;
        item.onclick = () => {
          nama.value = r.nama;
          nip.value  = r.nip_nik;
          box.classList.add('hidden');
        };
        box.appendChild(item);
      });

      box.classList.remove('hidden');
    }, 300);
  });

  document.addEventListener('click', e => {
    if (!box.contains(e.target) && e.target !== nama){
      box.classList.add('hidden');
    }
  });
}

window.onload = setupAutocomplete;
</script>
</body>
</html>
